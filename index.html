<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMINUS UMBREA | Omni-Terminal v70.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Rajdhani', sans-serif; background-color: #020202; color: #e2e8f0; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 2px; }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scan-beam {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(6, 182, 212, 0.1), transparent);
            animation: scanline 4s linear infinite;
            pointer-events: none; z-index: 50;
        }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-cyan-500 selection:text-black">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo, useCallback } = React;

        // --- ADAPTADOR DE ICONOS LUCIDE PARA REACT ---
        // Esto soluciona el problema de la pantalla blanca
        const LucideIcon = ({ name, size = 24, className }) => {
            const iconData = lucide.icons[name];
            if (!iconData) return null;
            return (
                <svg
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                >
                    {iconData.map(([tag, attrs], i) => React.createElement(tag, { ...attrs, key: i }))}
                </svg>
            );
        };

        // Mapeo de los iconos usados
        const ShieldCheck = (p) => <LucideIcon name="ShieldCheck" {...p} />;
        const Zap = (p) => <LucideIcon name="Zap" {...p} />;
        const Lock = (p) => <LucideIcon name="Lock" {...p} />;
        const Cpu = (p) => <LucideIcon name="Cpu" {...p} />;
        const Activity = (p) => <LucideIcon name="Activity" {...p} />;
        const Binary = (p) => <LucideIcon name="Binary" {...p} />;
        const Key = (p) => <LucideIcon name="Key" {...p} />;
        const Layers = (p) => <LucideIcon name="Layers" {...p} />;
        const Waves = (p) => <LucideIcon name="Waves" {...p} />;
        const Fingerprint = (p) => <LucideIcon name="Fingerprint" {...p} />;
        const RefreshCcw = (p) => <LucideIcon name="RefreshCcw" {...p} />;
        const Skull = (p) => <LucideIcon name="Skull" {...p} />;
        const Terminal = (p) => <LucideIcon name="Terminal" {...p} />;
        const FileUp = (p) => <LucideIcon name="FileUp" {...p} />;
        const Database = (p) => <LucideIcon name="Database" {...p} />;
        const Radio = (p) => <LucideIcon name="Radio" {...p} />;
        const Mic = (p) => <LucideIcon name="Mic" {...p} />;
        const ChevronUp = (p) => <LucideIcon name="ChevronUp" {...p} />;
        const ChevronDown = (p) => <LucideIcon name="ChevronDown" {...p} />;
        const Send = (p) => <LucideIcon name="Send" {...p} />;


        // --- COMPONENTES UI ---

        const LiquidRealityOverlay = ({ manifestations }) => (
            <div className="fixed inset-0 pointer-events-none overflow-hidden z-0">
                <div className="absolute inset-0 bg-gradient-to-br from-black via-slate-950 to-cyan-950 opacity-90" />
                {manifestations.map((m, i) => (
                    <div key={i} className="absolute rounded-full blur-3xl animate-pulse"
                        style={{ width: `${m.size}px`, height: `${m.size}px`, left: `${m.x}%`, top: `${m.y}%`, background: `radial-gradient(circle, ${m.color} 0%, transparent 70%)`, transform: `translate(-50%, -50%)`, transition: 'all 2s ease-in-out' }} />
                ))}
                <div className="scan-beam"></div>
            </div>
        );

        const AvatarSoberano = ({ vibration, locked }) => {
            const bars = Array.from({ length: 12 });
            return (
                <div className="relative flex items-center justify-center w-64 h-64">
                    {bars.map((_, i) => (
                        <div key={i} className="absolute w-1 bg-cyan-400 rounded-full"
                            style={{ height: `${20 + (vibration * 40)}px`, transform: `rotate(${i * 30}deg) translateY(-80px)`, opacity: 0.3 + (vibration * 0.7), transition: 'all 0.1s ease-out', boxShadow: `0 0 10px rgba(6,182,212, ${vibration})` }} />
                    ))}
                    <div className={`relative z-10 w-32 h-32 rounded-full flex items-center justify-center border-2 transition-all duration-75 ${locked ? 'border-red-500 shadow-[0_0_20px_rgba(239,68,68,0.5)] bg-red-950/20' : 'border-cyan-400 shadow-[0_0_30px_rgba(34,211,238,0.6)] bg-cyan-950/20'}`} style={{ transform: `scale(${1 + vibration * 0.2})` }}>
                        {locked ? <ShieldCheck size={64} className="text-red-500 animate-pulse" /> : <Skull size={64} className="text-cyan-400 animate-bounce" />}
                    </div>
                </div>
            );
        };

        const StatCard = ({ label, val, icon }) => (
            <div className="bg-zinc-950/80 border border-zinc-800 p-4 rounded-xl shadow-lg hover:border-cyan-900 transition-all group">
                <div className="flex items-center gap-2 text-zinc-500 text-[10px] mb-1 uppercase tracking-widest font-bold group-hover:text-cyan-600">
                    {icon} {label}
                </div>
                <div className="text-xl font-black text-white group-hover:text-cyan-400 font-mono">{val}</div>
            </div>
        );

        const HistoryLog = ({ history }) => {
            const endRef = useRef(null);
            useEffect(() => endRef.current?.scrollIntoView({ behavior: 'smooth' }), [history]);
            return (
                <div className="space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar flex-1 font-mono text-[10px]">
                    {history.map((item, idx) => (
                        <div key={idx} className={`p-2 rounded border ${item.type === 'SYS' ? 'bg-slate-900 border-cyan-900 text-cyan-300' : 'bg-black border-red-900 text-red-400'}`}>
                            <span className="opacity-50">[{item.time}]</span> <span className="font-bold">{item.type}:</span> {item.msg}
                        </div>
                    ))}
                    <div ref={endRef} />
                </div>
            );
        };

        // --- APP MAIN ---
        const App = () => {
            const [alpha, setAlpha] = useState(0.88);
            const [vibration, setVibration] = useState(0);
            const [headroom, setHeadroom] = useState(2.3);
            const [locked, setLocked] = useState(false);
            const [history, setHistory] = useState([{ type: 'SYS', msg: 'NEXO_LINGUISTICO_DMZ_v5.0 INICIADO', time: 'INIT' }]);
            const [isAudioActive, setIsAudioActive] = useState(false); // Nuevo estado para controlar audio

            const audioCtx = useRef(null);
            const oscillator = useRef(null);
            const gainNode = useRef(null);
            const analyser = useRef(null);

            // Simulación de Paradoja de Teseo
            const identityLoss = useMemo(() => {
                const recon = Math.random() * 5;
                return ((1 - alpha) * recon) + (alpha * 10);
            }, [alpha, vibration]);

            // Efecto de Audio Visualizer Corregido
            useEffect(() => {
                if (!isAudioActive) return;

                let animationFrameId;
                const dataArray = new Uint8Array(analyser.current.frequencyBinCount);

                const renderFrame = () => {
                    if (!analyser.current) return;
                    animationFrameId = requestAnimationFrame(renderFrame);
                    analyser.current.getByteTimeDomainData(dataArray);

                    let sum = 0;
                    for(let i = 0; i < dataArray.length; i++) {
                        sum += Math.pow((dataArray[i] / 128.0) - 1, 2);
                    }
                    const rms = Math.sqrt(sum / dataArray.length);
                    setVibration(rms * 5.0); // Amplificado para que se note más
                };

                renderFrame();

                return () => cancelAnimationFrame(animationFrameId);
            }, [isAudioActive]); // Se activa cuando isAudioActive cambia a true

            const addLog = (type, msg) => setHistory(prev => [...prev, { type, msg, time: new Date().toLocaleTimeString() }]);

            const toggleAudio = () => {
                if (audioCtx.current && audioCtx.current.state === 'running') {
                    audioCtx.current.suspend().then(() => {
                        setIsAudioActive(false);
                        addLog('SYS', 'EMISIÓN DE FRECUENCIA DETENIDA.');
                    });
                    return;
                }

                if (!audioCtx.current) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    audioCtx.current = new AudioContext();

                    // Cadena de audio: Oscilador -> Gain -> Analyser -> Destino
                    oscillator.current = audioCtx.current.createOscillator();
                    gainNode.current = audioCtx.current.createGain();
                    analyser.current = audioCtx.current.createAnalyser();
                    analyser.current.fftSize = 256;

                    oscillator.current.type = 'sawtooth';
                    oscillator.current.frequency.setValueAtTime(110, audioCtx.current.currentTime);

                    // Volumen bajo para no molestar
                    gainNode.current.gain.value = 0.1;

                    oscillator.current.connect(gainNode.current);
                    gainNode.current.connect(analyser.current);
                    analyser.current.connect(audioCtx.current.destination);

                    oscillator.current.start();
                }

                audioCtx.current.resume().then(() => {
                    setIsAudioActive(true);
                    addLog('SYS', 'NÚCLEO DE AUDIO INICIADO. EMITIENDO FRECUENCIA.');
                });
            };

            const handleAlphaChange = (e) => {
                const newAlpha = parseFloat(e.target.value);
                setAlpha(newAlpha);
                if (oscillator.current && audioCtx.current) {
                    // Detune modifica el tono en tiempo real basado en el slider
                    const detuneValue = (newAlpha - 0.5) * 2400;
                    oscillator.current.detune.setValueAtTime(detuneValue, audioCtx.current.currentTime);
                }
            };

            return (
                <div className="min-h-screen relative flex flex-col p-6 overflow-hidden">
                    <LiquidRealityOverlay manifestations={[{ x: 20, y: 30, color: 'rgba(0, 255, 255, 0.1)', size: 600 }, { x: 80, y: 70, color: 'rgba(220, 38, 38, 0.1)', size: 500 }]} />

                    {/* Header */}
                    <header className="relative z-10 flex justify-between items-center mb-8 border-b border-cyan-900/30 pb-4">
                        <div>
                            <h1 className="text-2xl font-black tracking-tighter text-white">DOMINUS<span className="text-cyan-500">_VOX</span></h1>
                            <p className="text-[10px] font-mono text-cyan-600 tracking-[0.3em]">OMNI-TERMINAL v70.2 | MÓDULO CLONACIÓN</p>
                        </div>
                        <div className="flex gap-4">
                            <div className="text-right">
                                <p className="text-[9px] text-gray-500 uppercase">Estado del Alma</p>
                                <p className={`text-xs font-bold ${alpha > 0.5 ? 'text-cyan-400' : 'text-red-500'}`}>{alpha > 0.5 ? 'SOBERANÍA' : 'ASIMILACIÓN'}</p>
                            </div>
                        </div>
                    </header>

                    {/* Main Grid */}
                    <main className="relative z-10 grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1">

                        {/* Panel Izquierdo: Control de Paradoja */}
                        <div className="space-y-6">
                            <div className="bg-slate-900/60 border border-cyan-900/30 p-5 rounded-2xl backdrop-blur-md">
                                <h3 className="text-xs font-bold text-white mb-4 flex items-center gap-2"><Fingerprint size={14}/> PARADOJA DE TESEO (α)</h3>
                                <input type="range" min="0" max="1" step="0.01" value={alpha} onChange={handleAlphaChange} className="w-full h-1 bg-gray-800 rounded-lg appearance-none cursor-pointer accent-cyan-500 mb-2" />
                                <div className="flex justify-between text-[9px] text-gray-500 font-mono uppercase">
                                    <span>Letra_Null (IA)</span>
                                    <span>Voz Original (Humano)</span>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <StatCard label="INTEGRIDAD" val={`${(100 - identityLoss).toFixed(1)}%`} icon={<Activity size={14} className="text-emerald-500"/>} />
                                <StatCard label="FRECUENCIA" val="+2.3 dB" icon={<Radio size={14} className="text-cyan-500"/>} />
                                <StatCard label="SINC_FASE" val="Φ 1.618" icon={<Waves size={14} className="text-purple-500"/>} />
                                <StatCard label="PÉRDIDA" val={`${identityLoss.toFixed(1)}%`} icon={<Zap size={14} className="text-red-500"/>} />
                            </div>

                            <button onClick={() => { setLocked(!locked); addLog('SYS', locked ? 'SISTEMA LIBERADO' : 'BLOQUEO ATÓMICO ACTIVO'); }} className={`w-full py-4 rounded-xl font-bold text-xs tracking-widest transition-all flex items-center justify-center gap-2 ${locked ? 'bg-red-900/20 text-red-500 border border-red-900' : 'bg-cyan-900/20 text-cyan-400 border border-cyan-900'}`}>
                                {locked ? <Lock size={14} /> : <Activity size={14} />}
                                {locked ? 'DESBLOQUEAR NÚCLEO' : 'BLOQUEAR FRECUENCIA'}
                            </button>
                        </div>

                        {/* Panel Central: Visualizador */}
                        <div className="flex flex-col items-center justify-center bg-black/40 rounded-3xl border border-gray-800 relative overflow-hidden group">
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(6,182,212,0.1)_0%,_transparent_60%)] opacity-50 group-hover:opacity-80 transition-opacity"></div>
                            <AvatarSoberano vibration={vibration} locked={locked} />
                            <div className="mt-8 text-center relative z-10">
                                <p className="text-[10px] font-mono text-cyan-600 animate-pulse mb-2">
                                    {locked ? 'ANALIZANDO PATRONES...' : 'ESPERANDO INPUT VOCAL...'}
                                </p>
                                <div className="h-1 w-32 bg-gray-800 rounded-full overflow-hidden mx-auto">
                                    <div className="h-full bg-cyan-400 transition-all duration-75" style={{ width: `${Math.min(100, vibration * 100)}%` }}></div>
                                </div>
                            </div>
                        </div>

                        {/* Panel Derecho: Logs y Comandos */}
                        <div className="flex flex-col bg-slate-900/60 border border-cyan-900/30 p-4 rounded-2xl backdrop-blur-md">
                            <div className="flex items-center justify-between mb-4 border-b border-gray-800 pb-2">
                                <span className="text-xs font-bold text-gray-400 flex items-center gap-2"><Terminal size={14}/> REGISTRO DEL SISTEMA</span>
                                <span className="text-[9px] text-cyan-600 font-mono">ENCRIPTADO</span>
                            </div>
                            <HistoryLog history={history} />
                            <div className="mt-4 pt-4 border-t border-gray-800">
                                <button className={`w-full font-bold py-2 rounded text-xs flex items-center justify-center gap-2 transition-colors ${isAudioActive ? 'bg-red-600 hover:bg-red-500 text-white' : 'bg-cyan-600 hover:bg-cyan-500 text-black'}`} onClick={toggleAudio}>
                                    <Mic size={14} /> {isAudioActive ? 'DETENER CAPTURA' : 'INICIAR CAPTURA DE VOZ'}
                                </button>
                            </div>
                        </div>

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
