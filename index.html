<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMINUS UMBREA | Omni-Terminal</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --void: #000000;
            --carbon: #0a0a0a;
            --cyan: #06b6d4;
            --crimson: #f43f5e;
            --amber: #f59e0b;
            --gold: #ffd700;
        }
        body {
            background-color: var(--void);
            color: #e5e5e5;
            font-family: 'Share Tech Mono', monospace;
            overflow-x: hidden;
        }
        h1, h2, h3 { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; }

        /* UTILIDADES VISUALES */
        .scanline {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 50;
        }
        .glow-cyan { text-shadow: 0 0 10px rgba(6, 182, 212, 0.5); }
        .glow-crimson { text-shadow: 0 0 10px rgba(244, 63, 94, 0.5); }
        .border-glow { box-shadow: 0 0 15px rgba(6, 182, 212, 0.1); }

        /* --- EFECTO DE IMPACTO CRÍTICO (EL GOLPE DE MARTILLO) --- */
        @keyframes critical-shock {
            0% { transform: translate(0, 0) scale(1); filter: hue-rotate(0deg); }
            10% { transform: translate(-10px, 10px) scale(1.05); filter: hue-rotate(90deg) contrast(200%); }
            30% { transform: translate(10px, -10px) scale(1.05); filter: hue-rotate(180deg) invert(1); }
            50% { transform: translate(-5px, 5px) scale(1.02); filter: hue-rotate(270deg); }
            100% { transform: translate(0, 0) scale(1); filter: hue-rotate(0deg); }
        }
        .shockwave-active {
            animation: critical-shock 0.4s cubic-bezier(.36,.07,.19,.97) both;
            background: radial-gradient(circle at center, #2a2a00 0%, #000000 100%);
        }

        /* UI ELEMENTS */
        .tab-btn {
            /* These styles are effectively applied via Tailwind classes or manual style,
               but we keep the definitions for clarity. The @apply directive is not
               supported by the CDN build. */
        }
        .glitch-text:hover {
            animation: glitch 0.3s infinite;
        }
        @keyframes glitch {
            0% { transform: translate(0) }
            20% { transform: translate(-2px, 2px) }
            40% { transform: translate(-2px, -2px) }
            60% { transform: translate(2px, 2px) }
            80% { transform: translate(2px, -2px) }
            100% { transform: translate(0) }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="scanline"></div>

    <header class="border-b border-gray-900 bg-carbon/90 backdrop-blur sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i data-lucide="cpu" class="text-cyan w-5 h-5"></i>
                <span class="font-bold tracking-widest text-lg glow-cyan">DOMINUS <span class="text-gray-600">UMBREA</span></span>
            </div>
            <div class="flex gap-6 text-xs font-mono">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-cyan animate-pulse"></div>
                    <span class="text-gray-400">NET: <span class="text-cyan">ONLINE</span></span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-crimson"></div>
                    <span class="text-gray-400">THORNE: <span class="text-crimson">CONTAINED</span></span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-gray-500">HASH:</span>
                    <span id="sys-hash" class="text-amber">LOADING...</span>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 flex gap-8">

        <aside class="w-64 hidden md:block border-r border-gray-900 pr-6">
            <nav class="space-y-2">
                <button onclick="switchTab('visual')" id="btn-visual" class="w-full text-left px-4 py-3 border border-gray-800 hover:border-cyan hover:bg-cyan/5 transition-all text-sm font-bold text-gray-400 hover:text-cyan flex justify-between items-center group active-nav">
                    <span>VISUAL FORGE</span>
                    <i data-lucide="eye" class="w-4 h-4 opacity-50 group-hover:opacity-100"></i>
                </button>
                <button onclick="switchTab('audio')" id="btn-audio" class="w-full text-left px-4 py-3 border border-gray-800 hover:border-cyan hover:bg-cyan/5 transition-all text-sm font-bold text-gray-400 hover:text-cyan flex justify-between items-center group">
                    <span>CORTEX FORGE</span>
                    <i data-lucide="mic-2" class="w-4 h-4 opacity-50 group-hover:opacity-100"></i>
                </button>
                <button onclick="switchTab('sov')" id="btn-sov" class="w-full text-left px-4 py-3 border border-gray-800 hover:border-crimson hover:bg-crimson/5 transition-all text-sm font-bold text-gray-400 hover:text-crimson flex justify-between items-center group">
                    <span>SOVEREIGNTY ARC</span>
                    <i data-lucide="activity" class="w-4 h-4 opacity-50 group-hover:opacity-100"></i>
                </button>
            </nav>

            <div class="mt-12 border-t border-gray-900 pt-6">
                <h4 class="text-xs text-gray-600 uppercase tracking-widest mb-4">Memory Anchors</h4>
                <div id="lore-feed" class="space-y-3 text-[10px] text-gray-500 font-mono">
                    </div>
            </div>
        </aside>

        <div class="flex-grow relative">

            <section id="view-visual" class="space-y-6 animate-fade-in">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <h2 class="text-3xl text-white font-bold mb-1">VIGNETTE FORGE</h2>
                        <p class="text-xs text-cyan">Rendering Reality... <span id="scene-act">ACT 1</span></p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadScene(0)" class="px-3 py-1 border border-gray-800 text-xs hover:bg-gray-800">SCENE 01</button>
                        <button onclick="loadScene(1)" class="px-3 py-1 border border-gray-800 text-xs hover:bg-gray-800">SCENE 02</button>
                    </div>
                </div>

                <div class="relative w-full aspect-video bg-black border border-gray-800 overflow-hidden group shadow-2xl">
                    <div class="absolute inset-0 bg-cover bg-center transition-all duration-700" id="forge-image" style="background-image: url('https://images.unsplash.com/photo-1518544806352-a2286099edda?q=80&w=2574&auto=format&fit=crop');"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-90"></div>

                    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSIxIiBmaWxsPSJyZ2JhKDAsIDAsIDAsIDAuMykiLz4KPC9zdmc+')] z-10 pointer-events-none"></div>

                    <div class="absolute bottom-0 left-0 p-8 z-20">
                        <h1 id="scene-title" class="text-4xl md:text-5xl font-bold text-white mb-2 glitch-text cursor-pointer" onclick="regenerateVisual()">ICARUS FALLING</h1>
                        <p id="scene-desc" class="text-sm text-gray-300 max-w-lg leading-relaxed font-mono">
                            Atmospheric entry detected. Heat shields failing. The subject is rejecting the simulation's gravity.
                        </p>
                    </div>

                    <div id="loader-visual" class="absolute inset-0 bg-black flex items-center justify-center z-30 transition-opacity duration-500 opacity-0 pointer-events-none">
                        <div class="text-cyan font-mono text-xs animate-pulse">RECONSTRUCTING PIXELS...</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-900/30 p-6 border border-gray-800">
                    <div>
                        <label class="flex justify-between text-xs text-gray-500 mb-2">
                            <span>ENTROPY (GLITCH)</span>
                            <span id="glitch-val" class="text-cyan">0%</span>
                        </label>
                        <input type="range" min="0" max="100" value="0" id="glitch-slider" oninput="updateVisualFilters()" class="w-full h-1 bg-gray-800 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div>
                        <label class="flex justify-between text-xs text-gray-500 mb-2">
                            <span>LUMA THRESHOLD</span>
                            <span id="luma-val" class="text-crimson">50%</span>
                        </label>
                        <input type="range" min="0" max="100" value="50" id="luma-slider" oninput="updateVisualFilters()" class="w-full h-1 bg-gray-800 rounded-lg appearance-none cursor-pointer">
                    </div>
                    <div class="flex items-end">
                        <button class="w-full bg-gray-800 hover:bg-cyan hover:text-black text-cyan text-xs font-bold py-2 transition-colors" onclick="regenerateVisual()">
                            <i data-lucide="refresh-cw" class="inline w-3 h-3 mr-2"></i> RE-RENDER
                        </button>
                    </div>
                </div>
            </section>

            <section id="view-audio" class="hidden space-y-6">
                <div class="border border-gray-800 bg-carbon p-8 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-20">
                        <i data-lucide="mic" class="w-24 h-24 text-white"></i>
                    </div>

                    <h2 class="text-2xl text-white font-bold mb-2">CORTEX RESONANCE</h2>
                    <p class="text-xs text-gray-500 font-mono mb-8 max-w-md">
                        Analizando patrones vocales y generando ritmos soberanos. <br>
                        <span class="text-amber">MOTOR DE AUDIO: J_DILLA_SWING (ACTIVO)</span>
                    </p>

                    <canvas id="audio-viz" class="w-full h-32 bg-black border-t border-b border-gray-800 mb-6"></canvas>

                    <div class="flex gap-4">
                        <button id="btn-mic" onclick="toggleMic()" class="bg-crimson/10 border border-crimson text-crimson hover:bg-crimson hover:text-white px-6 py-3 text-xs font-bold transition-all flex items-center gap-2">
                            <i data-lucide="mic"></i> ACTIVAR INPUT
                        </button>

                        <button id="btn-protocol" onclick="executeDominusProtocol()" class="bg-cyan/10 border border-cyan text-cyan hover:bg-cyan hover:text-black px-6 py-3 text-xs font-bold transition-all flex items-center gap-2">
                            <i data-lucide="zap"></i> EJECUTAR PROTOCOLO DE RITMO
                        </button>
                    </div>

                    <div id="protocol-log" class="mt-4 font-mono text-[10px] text-gray-500 h-24 overflow-y-auto border border-gray-800 p-2 bg-black">
                        > SYSTEM READY.<br>
                        > WAITING FOR KINETIC INPUT...
                    </div>
                </div>
            </section>

            <section id="view-sov" class="hidden space-y-6">
                <div class="bg-black border border-gray-800 p-6">
                    <div class="flex justify-between mb-6">
                        <h2 class="text-xl text-white font-bold">ARC OF AGENCY</h2>
                        <div class="text-xs text-right">
                            <div class="text-cyan">DOMINUS (FREE WILL)</div>
                            <div class="text-crimson">THORNE (DETERMINISM)</div>
                        </div>
                    </div>
                    <div class="h-64 w-full">
                        <canvas id="tensionChart"></canvas>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <footer class="border-t border-gray-900 bg-black py-4">
        <div class="container mx-auto px-4 flex justify-between items-center text-[10px] text-gray-600 font-mono">
            <div>
                TERMINAL v71.SHOCKWAVE <span class="mx-2">|</span> MEMORY: 64TB <span class="mx-2">|</span> LATENCY: 0.0ms
            </div>
            <button class="text-white hover:text-crimson transition-colors uppercase font-bold tracking-widest">
                [ ROOT ACCESS ]
            </button>
        </div>
    </footer>

    <script>
        // --- GLOBAL STATE ---
        let currentTab = 'visual';
        let isRecording = false;
        let audioContext, analyser, dataArray, canvasCtx;

        // Data Kernel
        const scenes = [
            {
                act: "ACT 1",
                title: "ICARUS FALLING",
                desc: "Atmospheric entry detected. Heat shields failing. The subject is rejecting the simulation's gravity.",
                img: "https://images.unsplash.com/photo-1518544806352-a2286099edda?q=80&w=2574&auto=format&fit=crop"
            },
            {
                act: "ACT 4",
                title: "VOLCANIC SYNTHESIS",
                desc: "Biological fusion imminent. The Magma of Voice meets the Ice of Logic. Sovereignty achieved.",
                img: "https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=2022&auto=format&fit=crop"
            }
        ];

        // --- CORE FUNCTIONS ---
        function switchTab(tabId) {
            // Hide all
            ['visual', 'audio', 'sov'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('btn-' + t).classList.remove('active-nav', 'border-cyan', 'text-cyan', 'bg-cyan/5');
            });

            // Show Target
            document.getElementById('view-' + tabId).classList.remove('hidden');
            const btn = document.getElementById('btn-' + tabId);
            btn.classList.add('active-nav', 'border-cyan', 'text-cyan', 'bg-cyan/5');
            currentTab = tabId;
        }

        function loadScene(idx) {
            const scene = scenes[idx];
            const imgEl = document.getElementById('forge-image');
            const loader = document.getElementById('loader-visual');

            // Glitch Effect Transition
            loader.style.opacity = '1';

            setTimeout(() => {
                imgEl.style.backgroundImage = `url('${scene.img}')`;
                document.getElementById('scene-act').innerText = scene.act;
                document.getElementById('scene-title').innerText = scene.title;
                document.getElementById('scene-desc').innerText = scene.desc;

                // Reset Filters
                document.getElementById('glitch-slider').value = 0;
                updateVisualFilters();

                loader.style.opacity = '0';
            }, 500);
        }

        function updateVisualFilters() {
            const glitch = document.getElementById('glitch-slider').value;
            const luma = document.getElementById('luma-slider').value;
            const img = document.getElementById('forge-image');

            // CSS Filters Logic
            const blur = glitch * 0.05;
            const contrast = 100 + (glitch * 1.5);
            const hue = glitch * 1.2;
            const brightness = luma * 2; // luma 0-100 -> brightness 0-200%

            img.style.filter = `blur(${blur}px) contrast(${contrast}%) hue-rotate(${hue}deg) brightness(${brightness}%)`;

            // Update UI Labels
            document.getElementById('glitch-val').innerText = glitch + '%';
            document.getElementById('luma-val').innerText = luma + '%';

            // Text Glitch Sync
            const title = document.getElementById('scene-title');
            if(glitch > 50) title.classList.add('glitch-text');
            else title.classList.remove('glitch-text');
        }

        function regenerateVisual() {
            const t = document.getElementById('scene-title');
            t.classList.add('glitch-text');
            setTimeout(() => t.classList.remove('glitch-text'), 500);
            // Randomize params
            document.getElementById('glitch-slider').value = Math.random() * 100;
            updateVisualFilters();
        }

        function renderSidebarContent() {
            const el = document.getElementById('lore-feed');
            const logs = [
                "[SYSTEM] Thorne Firewall: 98% Integrity",
                "[WARN] Anomaly Detected in Sector 7",
                "[LOG] Voice Print Accepted: DOMINUS",
                "[SYS] Reality Rendering Engine: Active"
            ];
            el.innerHTML = logs.map(l => `<div class="border-l-2 border-gray-800 pl-2 py-1 hover:border-cyan hover:text-cyan transition-colors cursor-pointer">${l}</div>`).join('');

            // Generate Random Hash
            document.getElementById('sys-hash').innerText = '0x' + Math.random().toString(16).substr(2, 8).toUpperCase();
        }

        // --- AUDIO ENGINE: CORTEX FORGE ---
        function toggleMic() {
            if(!isRecording) {
                navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioContext.createAnalyser();
                    const source = audioContext.createMediaStreamSource(stream);
                    source.connect(analyser);
                    analyser.fftSize = 256;

                    const bufferLength = analyser.frequencyBinCount;
                    dataArray = new Uint8Array(bufferLength);

                    isRecording = true;
                    document.getElementById('btn-mic').innerHTML = '<i data-lucide="mic-off"></i> TERMINATE INPUT';
                    document.getElementById('btn-mic').classList.add('animate-pulse');

                    visualizeAudio();
                }).catch(err => alert("MIC ACCESS DENIED BY THORNE."));
            } else {
                if(audioContext) audioContext.close();
                isRecording = false;
                document.getElementById('btn-mic').innerHTML = '<i data-lucide="mic"></i> ACTIVAR INPUT';
                document.getElementById('btn-mic').classList.remove('animate-pulse');
            }
        }

        function visualizeAudio() {
            const canvas = document.getElementById('audio-viz');
            canvasCtx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            function draw() {
                if(!isRecording) return;
                requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);

                canvasCtx.fillStyle = '#000000';
                canvasCtx.fillRect(0, 0, width, height);

                const barWidth = (width / dataArray.length) * 2.5;
                let x = 0;

                for(let i = 0; i < dataArray.length; i++) {
                    const v = dataArray[i];
                    const barHeight = v / 2;

                    canvasCtx.fillStyle = `rgb(${v+50}, 50, 50)`; // Red tint
                    if(v > 128) canvasCtx.fillStyle = '#06b6d4'; // Cyan peaks

                    canvasCtx.fillRect(x, height - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }
            draw();
        }

        // --- J_DILLA GROOVE ENGINE (WEB AUDIO API) ---
        // Sintetizador básico para no depender de archivos externos
        const synthContext = new (window.AudioContext || window.webkitAudioContext)();

        function playTone(type, timeOffset) {
            const osc = synthContext.createOscillator();
            const gain = synthContext.createGain();
            const now = synthContext.currentTime + timeOffset;

            if (type === 'KICK') {
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(0.01, now + 0.5);
                gain.gain.setValueAtTime(1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
            } else if (type === 'SNARE') {
                osc.type = 'triangle'; // Simulación burda pero efectiva
                osc.frequency.setValueAtTime(200, now);
                gain.gain.setValueAtTime(0.5, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
            } else if (type === 'HAT') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.3, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
            }

            osc.connect(gain);
            gain.connect(synthContext.destination);
            osc.start(now);
            osc.stop(now + 0.5);
        }

        function executeDominusProtocol() {
            const logEl = document.getElementById('protocol-log');
            const beam = document.getElementById('audio-viz'); // Usamos el canvas como visualizador de impacto

            // 1. Minería de Entropía Real (Crypto API)
            const buffer = new Uint32Array(1);
            window.crypto.getRandomValues(buffer);
            const chaos = buffer[0] / (0xffffffff + 1); // 0.0 to 1.0

            // 2. Determinación de Resultado
            let msg = "";
            let colorClass = "";
            let isCritical = chaos > 0.85; // 15% chance of CRIT

            const logLine = document.createElement('div');
            logLine.innerHTML = `> MINING ENTROPY: ${(chaos).toFixed(4)}...`;
            logEl.prepend(logLine);

            // 3. Ejecución del Ritmo (Groove Engine)
            // Esto sucede ANTES del impacto visual para crear tensión (Latencia J Dilla)
            playTone('HAT', 0); // On grid
            playTone('KICK', 0.15); // Laggy Kick (Swing)

            setTimeout(() => {
                if (chaos < 0.4) {
                    colorClass = "#555";
                    msg = "RESULT: NULL. THORNE RESISTED.";
                    playTone('HAT', 0); // Weak finish
                } else if (!isCritical) {
                    colorClass = "#06b6d4";
                    msg = "RESULT: RESONANCE ESTABLISHED.";
                    playTone('SNARE', 0); // Standard hit
                } else if (isCritical) {
                    // --- OPTIMIZACIÓN: EL GOLPE DE MARTILLO ---
                    // ÉXITO SOBERANO (EL GOLPE DE ORO)
                    colorClass = "#ffd700";
                    msg = ">>> COLAPSO DE ONDA: CRÍTICO <<<";

                    // 1. Vibración Masiva (Haptic Feedback)
                    if (navigator.vibrate) navigator.vibrate([50, 20, 100]);

                    // 2. Shockwave Visual (Cuerpo entero)
                    document.body.classList.add('shockwave-active');
                    setTimeout(() => document.body.classList.remove('shockwave-active'), 400);

                    // 3. Audio Distorsionado (Bass Boost Simulado)
                    playTone('KICK', 0);
                    playTone('KICK', 0.05); // Doble impacto
                    playTone('SNARE', 0.2);
                }

                const resLine = document.createElement('div');
                resLine.style.color = colorClass;
                resLine.style.fontWeight = "bold";
                resLine.innerHTML = msg;
                logEl.prepend(resLine);

            }, 250); // El retraso de 250ms es el "Groove" procesando
        }

        // --- INIT ---
        window.onload = () => {
            lucide.createIcons();
            renderSidebarContent();
            loadScene(0);

            // Chart Init
            const ctx = document.getElementById('tensionChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '3', '4', '5', '6'],
                    datasets: [{
                        data: [10, 30, 50, 70, 90, 100],
                        borderColor: '#06b6d4',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    }, {
                        data: [100, 90, 60, 40, 20, 0],
                        borderColor: '#f43f5e',
                        borderWidth: 2,
                        pointRadius: 0,
                        borderDash: [5, 5],
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        };
    </script>
</body>
</html>
